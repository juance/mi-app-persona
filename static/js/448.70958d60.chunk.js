"use strict";(self.webpackChunkmi_app_personal=self.webpackChunkmi_app_personal||[]).push([[448],{1301:(r,t,a)=>{a.d(t,{zS:()=>v,Uw:()=>E,I0:()=>y,j3:()=>b,AF:()=>_});var o=a(372);const e=r=>{const t={isValid:!0,errors:[]};return r.title&&""!==r.title.trim()||(t.isValid=!1,t.errors.push("El t\xedtulo es obligatorio")),(!r.amount||isNaN(r.amount)||r.amount<=0)&&(t.isValid=!1,t.errors.push("El monto debe ser un n\xfamero mayor que cero")),r.type&&["income","expense"].includes(r.type)||(t.isValid=!1,t.errors.push("El tipo debe ser ingreso o gasto")),r.date||(t.isValid=!1,t.errors.push("La fecha es obligatoria")),t};var n=a(8634),s=a(377);const i="mi_app_personal_direct_",c=(r,t)=>{if(!r||!t)return console.error("Se requiere userId y transactions para guardar en localStorage"),!1;try{const a={transactions:t,timestamp:Date.now(),count:t.length},o=`${i}transactions_${r}`;return localStorage.setItem(o,JSON.stringify(a)),console.log(`Guardadas ${t.length} transacciones en localStorage para el usuario ${r}`),!0}catch(a){return console.error("Error al guardar transacciones en localStorage:",a),!1}},l=r=>{if(!r)return console.error("Se requiere userId para obtener transacciones de localStorage"),[];try{const t=`${i}transactions_${r}`,a=localStorage.getItem(t);if(!a)return console.log(`No hay transacciones guardadas en localStorage para el usuario ${r}`),[];const o=JSON.parse(a);return console.log(`Recuperadas ${o.transactions.length} transacciones de localStorage para el usuario ${r} (guardadas hace ${Math.round((Date.now()-o.timestamp)/1e3/60)} minutos)`),o.transactions||[]}catch(t){return console.error("Error al obtener transacciones de localStorage:",t),[]}},d="mi_app_personal_local_",u="demo_user",g=(r,t)=>{if(!r)return console.error("Se requiere key para guardar en localStorage"),!1;try{const a=`${d}${r}`,o={data:t,timestamp:Date.now()};return localStorage.setItem(a,JSON.stringify(o)),console.log(`Datos guardados en localStorage con clave ${r}`),!0}catch(a){return console.error(`Error al guardar ${r} en localStorage:`,a),!1}},f=function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!r)return console.error("Se requiere key para obtener de localStorage"),t;try{const a=`${d}${r}`,o=localStorage.getItem(a);if(!o)return t;const e=JSON.parse(o);return console.log(`Datos recuperados de localStorage con clave ${r} (guardados hace ${Math.round((Date.now()-e.timestamp)/1e3/60)} minutos)`),e.data}catch(a){return console.error(`Error al obtener ${r} de localStorage:`,a),t}},m=r=>g("transactions",r),h=()=>f("transactions",[]),p=r=>{try{const t={...r,id:r.id||`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,user_id:r.user_id||u,created_at:r.created_at||(new Date).toISOString()},a=[t,...h()];return m(a)}catch(t){return console.error("Error al agregar transacci\xf3n:",t),!1}},y=async()=>{try{const{data:{user:t}}=await o.N.auth.getUser();if(!t){console.log("No authenticated user found, using local storage");const r=h();return console.log(`Obtenidas ${r.length} transacciones del almacenamiento local independiente`),r}const a=`transactions_${t.id}`,e=l(t.id);let i=e.length>0?e:[];const d=async()=>{console.log("Fetching transactions from Supabase");const{data:r,error:a}=await o.N.from("transactions").select("*").eq("user_id",t.id).order("date",{ascending:!1});if(a)throw console.error("Error fetching transactions from Supabase:",a),a;const e=r||[];return e.length>0?(console.log(`Guardando ${e.length} transacciones en IndexedDB`),await(0,s.cZ)("transactions",e),c(t.id,e)):console.log("No hay transacciones para guardar en IndexedDB"),e},u=async()=>{console.log("Fetching transactions from IndexedDB");try{const r=await(0,s.Wj)("transactions");console.log(`Obtenidas ${r.length} transacciones de IndexedDB`);const a=r.filter((r=>r.user_id===t.id));return console.log(`Filtradas ${a.length} transacciones del usuario ${t.id}`),a.length>0&&c(t.id,a),a}catch(r){return console.error("Error al obtener transacciones de IndexedDB:",r),i}};if(!(0,s.KJ)()){console.log("Offline mode: using IndexedDB");const r=await u(),t=r.length>0?r:i;return(0,n.K1)(a,t,18e5,{priority:!0}),t}try{if((await u()).length<5){console.log("Pocos datos en IndexedDB, obteniendo desde Supabase");const r=await d();return(0,n.K1)(a,r,3e5,{priority:!0}),r}return await(0,n.nT)(d,a,3e5,{priority:!0})}catch(r){console.error("Error fetching from Supabase with cache:",r);const t=await u();return t.length>0?t:i}}catch(r){console.error("Error in getTransactions:",r);try{const{data:{user:r}}=await o.N.auth.getUser();if(r){try{const t=(await(0,s.Wj)("transactions")).filter((t=>t.user_id===r.id));if(t.length>0)return t}catch(t){console.error("Error fetching from IndexedDB:",t)}const a=l(r.id);if(a.length>0)return a}}catch(t){console.error("Error fetching user or local data:",t)}return console.log("Fallback to local storage"),h()}},w=async r=>{try{const{data:{user:a}}=await o.N.auth.getUser();if(!a)throw new Error("No authenticated user found");const e=`transaction_${r}`,i=async()=>{const{data:t,error:e}=await o.N.from("transactions").select("*").eq("id",r).eq("user_id",a.id).single();if(e)throw e;return t},c=async()=>{try{return await(0,s.Wj)("transactions",r)}catch(t){return null}};if(!(0,s.KJ)())return await c();try{return await(0,n.nT)(i,e,3e5,{priority:!0})}catch(t){return console.error("Error fetching transaction from Supabase:",t),await c()}}catch(t){return console.error("Error in getTransactionById:",t),null}},S=w,v=async r=>{try{const{data:{user:h}}=await o.N.auth.getUser(),y=e(r);if(!y.isValid)throw new Error(`Validation error: ${y.errors.join(", ")}`);const{id:w,platformType:S,...v}=r;if(!h){console.log("No authenticated user found, using local storage");const r={...v,platform:S&&v.platform?`${S}:${v.platform}`:v.platform,user_id:u,id:w||`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,created_at:(new Date).toISOString()};if(p(r))return console.log("Transaction saved to local storage:",r),r;throw new Error("Error saving transaction to local storage")}console.log("Current user:",h);const _={...v,platform:S&&v.platform?`${S}:${v.platform}`:v.platform,user_id:h.id,id:w||`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`};console.log("Final transaction data:",_);const E=async r=>{try{const t=[r,...l(h.id)];c(h.id,t),console.log("Transaction added to localStorage")}catch(t){console.error("Error updating localStorage:",t)}};if((0,s.KJ)()){const{data:r,error:e}=await o.N.from("transactions").insert([_]).select();if(e){if(console.error("Error creating transaction:",e),console.error("Error details:",e.details,e.hint,e.message),e.message.includes("violates foreign key constraint")){var t,a,i,d,g,f,m;const{error:r}=await o.N.from("profiles").upsert([{id:h.id,first_name:(null===(t=h.user_metadata)||void 0===t?void 0:t.first_name)||(null===(a=h.user_metadata)||void 0===a||null===(i=a.name)||void 0===i?void 0:i.split(" ")[0])||"Usuario",last_name:(null===(d=h.user_metadata)||void 0===d?void 0:d.last_name)||(null===(g=h.user_metadata)||void 0===g||null===(f=g.name)||void 0===f?void 0:f.split(" ").slice(1).join(" "))||"",avatar_url:(null===(m=h.user_metadata)||void 0===m?void 0:m.avatar_url)||null,preferences:{}}]);if(r)return console.error("Error creating profile:",r),await(0,s.cZ)("transactions",_),await(0,s.dk)({type:"CREATE",storeName:"transactions",data:_}),await E(_),p(_),(0,n.WS)(`transactions_${h.id}`),console.log("Transaction saved locally due to profile error:",_),_;const{data:e,error:c}=await o.N.from("transactions").insert([_]).select();return c?(console.error("Error creating transaction (retry):",c),await(0,s.cZ)("transactions",_),await(0,s.dk)({type:"CREATE",storeName:"transactions",data:_}),await E(_),p(_),(0,n.WS)(`transactions_${h.id}`),console.log("Transaction saved locally after retry error:",_),_):(console.log("Transaction created successfully (after profile creation):",null===e||void 0===e?void 0:e[0]),null!==e&&void 0!==e&&e[0]&&(await(0,s.cZ)("transactions",e[0]),await E(e[0]),p(e[0])),(0,n.WS)(`transactions_${h.id}`),(null===e||void 0===e?void 0:e[0])||null)}return await(0,s.cZ)("transactions",_),await(0,s.dk)({type:"CREATE",storeName:"transactions",data:_}),await E(_),p(_),(0,n.WS)(`transactions_${h.id}`),console.log("Transaction saved locally due to error:",_),_}return console.log("Transaction created successfully in Supabase:",null===r||void 0===r?void 0:r[0]),null!==r&&void 0!==r&&r[0]&&(await(0,s.cZ)("transactions",r[0]),await E(r[0]),p(r[0])),(0,n.WS)(`transactions_${h.id}`),(null===r||void 0===r?void 0:r[0])||null}return await(0,s.cZ)("transactions",_),await(0,s.dk)({type:"CREATE",storeName:"transactions",data:_}),await E(_),p(_),(0,n.WS)(`transactions_${h.id}`),console.log("Transaction created locally (offline mode):",_),_}catch(h){console.error("Error in createTransaction:",h);try{if(r){const t={...r,id:r.id||`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,user_id:u,created_at:(new Date).toISOString()};if(p(t))return console.log("Transaction saved to local storage as fallback:",t),t}}catch(y){console.error("Error saving to local storage as fallback:",y)}throw h}},_=async(r,t)=>{try{const{data:{user:i}}=await o.N.auth.getUser();if(!i)throw new Error("No authenticated user found");let d;try{d=await(0,s.Wj)("transactions",r)}catch(a){console.log("Transaction not found in IndexedDB, trying Supabase")}if(d||(d=await S(r)),!d)throw new Error("Transaction not found");if(d.user_id!==i.id)throw new Error("You do not have permission to update this transaction");const u={...d,...t},g=e(u);if(!g.isValid)throw new Error(`Validation error: ${g.errors.join(", ")}`);const{platformType:f,...m}=t,h=f&&m.platform?{...m,platform:`${f}:${m.platform}`}:m;console.log("Updating transaction with data:",h);const p=async r=>{try{const t=l(i.id).map((t=>t.id===r.id?r:t));c(i.id,t),console.log("Transaction updated in localStorage")}catch(a){console.error("Error updating localStorage:",a)}};if((0,s.KJ)()){const{data:t,error:a}=await o.N.from("transactions").update(h).eq("id",r).select();if(a){console.error("Error updating transaction in Supabase:",a),console.error("Error details:",a.details,a.hint,a.message);const r={...d,...h};return await(0,s.cZ)("transactions",r),await(0,s.dk)({type:"UPDATE",storeName:"transactions",data:r}),await p(r),(0,n.WS)(`transactions_${i.id}`),console.log("Transaction updated locally due to error:",r),r}return console.log("Transaction updated successfully in Supabase:",null===t||void 0===t?void 0:t[0]),null!==t&&void 0!==t&&t[0]&&(await(0,s.cZ)("transactions",t[0]),await p(t[0])),(0,n.WS)(`transactions_${i.id}`),(null===t||void 0===t?void 0:t[0])||null}{const r={...d,...h};return await(0,s.cZ)("transactions",r),await(0,s.dk)({type:"UPDATE",storeName:"transactions",data:r}),await p(r),(0,n.WS)(`transactions_${i.id}`),console.log("Transaction updated locally (offline mode):",r),r}}catch(i){throw console.error("Error in updateTransaction:",i),i}},E=async r=>{try{const{data:{user:a}}=await o.N.auth.getUser();if(!a)throw new Error("No authenticated user found");let e;try{e=await(0,s.Wj)("transactions",r)}catch(t){console.log("Transaction not found in IndexedDB, trying Supabase")}if(e||(e=await w(r)),!e)throw new Error("Transaction not found or you do not have permission to delete it");if(e.user_id!==a.id)throw new Error("You do not have permission to delete this transaction");const i=async()=>{try{const t=l(a.id).filter((t=>t.id!==r));c(a.id,t),console.log("Transaction removed from localStorage")}catch(t){console.error("Error updating localStorage:",t)}};if((0,s.KJ)()){const{error:t}=await o.N.from("transactions").delete().eq("id",r).eq("user_id",a.id);return t?(console.error("Error deleting transaction from Supabase:",t),await(0,s.Dl)("transactions",r),await(0,s.dk)({type:"DELETE",storeName:"transactions",data:{id:r,user_id:a.id}}),await i(),(0,n.WS)(`transactions_${a.id}`),console.log("Transaction marked for deletion locally due to error"),!0):(await(0,s.Dl)("transactions",r),await i(),(0,n.WS)(`transactions_${a.id}`),console.log("Transaction deleted successfully from Supabase and IndexedDB"),!0)}return await(0,s.Dl)("transactions",r),await(0,s.dk)({type:"DELETE",storeName:"transactions",data:{id:r,user_id:a.id}}),await i(),(0,n.WS)(`transactions_${a.id}`),console.log("Transaction marked for deletion locally (offline mode)"),!0}catch(a){throw console.error("Error in deleteTransaction:",a),a}},b=async r=>{let{start:t=0,end:a=10,filters:e={},sort:i={column:"date",direction:"desc"}}=r;try{const{data:{user:r}}=await o.N.auth.getUser();if(!r)throw new Error("No authenticated user found");const l=JSON.stringify(e),d=JSON.stringify(i),u=`transactions_paginated_${r.id}_${t}_${a}_${l}_${d}`,g=async()=>{let n=o.N.from("transactions").select("*",{count:"exact"}).eq("user_id",r.id);e.type&&(n=n.eq("type",e.type)),e.category&&(n=n.eq("category",e.category)),e.platform&&(n=n.eq("platform",e.platform)),e.startDate&&(n=n.gte("date",e.startDate)),e.endDate&&(n=n.lte("date",e.endDate)),e.minAmount&&(n=n.gte("amount",e.minAmount)),e.maxAmount&&(n=n.lte("amount",e.maxAmount)),e.search&&(n=n.ilike("title",`%${e.search}%`)),n=n.order(i.column,{ascending:"asc"===i.direction}),n=n.range(t,a-1);const{data:s,error:c,count:l}=await n;if(c)throw c;return{data:s||[],count:l||0,hasMore:(l||0)>a}},f=async()=>{try{let o=(await(0,s.Wj)("transactions")).filter((t=>t.user_id===r.id));if(e.type&&(o=o.filter((r=>r.type===e.type))),e.category&&(o=o.filter((r=>r.category===e.category))),e.platform&&(o=o.filter((r=>r.platform===e.platform))),e.startDate&&(o=o.filter((r=>r.date>=e.startDate))),e.endDate&&(o=o.filter((r=>r.date<=e.endDate))),e.minAmount&&(o=o.filter((r=>r.amount>=e.minAmount))),e.maxAmount&&(o=o.filter((r=>r.amount<=e.maxAmount))),e.search){const r=e.search.toLowerCase();o=o.filter((t=>t.title&&t.title.toLowerCase().includes(r)))}o.sort(((r,t)=>{const a=r[i.column],o=t[i.column];return"asc"===i.direction?a<o?-1:a>o?1:0:a>o?-1:a<o?1:0}));return{data:o.slice(t,a),count:o.length,hasMore:o.length>a}}catch(o){return console.error("Error fetching from IndexedDB:",o),{data:[],count:0,hasMore:!1}}};if(!(0,s.KJ)())return await f();try{return await(0,n.nT)(g,u,12e4,{priority:!1})}catch(c){return console.error("Error fetching paginated transactions from Supabase:",c),await f()}}catch(c){return console.error("Error in getTransactionsPaginated:",c),{data:[],count:0,hasMore:!1}}}},7607:(r,t,a)=>{a.d(t,{Ej:()=>g,hZ:()=>c,ib:()=>u,lI:()=>s,vv:()=>l});var o=a(6213);const e="exchange_rates",n="exchange_rates_history",s=async()=>{try{const t=localStorage.getItem(e);if(t){const{rates:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<36e5)return console.log("Usando tasas de cambio en cach\xe9"),r}console.log("Obteniendo tasas de cambio de la API");try{const r=(await o.A.get("https://api.exchangerate-api.com/v4/latest/USD")).data.rates,t=Date.now();return localStorage.setItem(e,JSON.stringify({rates:r,timestamp:t})),d(r,t),r}catch(r){return console.error("Error al obtener tasas de cambio de la API:",r),i()}}catch(t){return console.error("Error en getExchangeRates:",t),i()}},i=()=>({USD:1,ARS:900,EUR:.92,BRL:5.5,CLP:950,MXN:17.5}),c=async function(r,t,a){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{if(t===a)return r;const e=o||await s(),n="USD"===t?r:r/e[t];return"USD"===a?n:n*e[a]}catch(e){console.error("Error en convertCurrency:",e);const o=i(),n="USD"===t?r:r/o[t];return"USD"===a?n:n*o[a]}},l=function(r){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ARS";return new Intl.NumberFormat("es-AR",{style:"currency",currency:t,maximumFractionDigits:2}).format(r)},d=(r,t)=>{try{const a=localStorage.getItem(n),o=a?JSON.parse(a):[],e={rates:{USD:r.USD||1,ARS:r.ARS||900,EUR:r.EUR||.92,BRL:r.BRL||5.5,CLP:r.CLP||950,MXN:r.MXN||17.5},timestamp:t};o.unshift(e);const s=o.slice(0,30);localStorage.setItem(n,JSON.stringify(s))}catch(a){console.error("Error al guardar en el historial de tasas de cambio:",a)}},u=()=>{try{const r=localStorage.getItem(n);return r?JSON.parse(r):[]}catch(r){return console.error("Error al obtener historial de tasas de cambio:",r),[]}},g=async(r,t)=>{try{if(r===t)return 1;const a=await s(),o="USD"===r?1:a[r];return("USD"===t?1:a[t])/o}catch(a){console.error("Error en getExchangeRate:",a);const o=i(),e="USD"===r?1:o[r];return("USD"===t?1:o[t])/e}}},8634:(r,t,a)=>{a.d(t,{K1:()=>n,WS:()=>s,nT:()=>i});const o=new Map,e=3e5;const n=function(r,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};o.size>=100&&c();const s=a>0?Date.now()+a:null;return o.set(r,{value:t,expiresAt:s,createdAt:Date.now(),lastAccessed:Date.now(),accessCount:0,priority:n.priority||!1}),!0},s=r=>o.delete(r),i=async function(r,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=(r=>{const t=o.get(r);return t?t.expiresAt&&Date.now()>t.expiresAt?(o.delete(r),null):(t.lastAccessed=Date.now(),t.accessCount++,t.value):null})(t);if(null!==i)return i;const c=await r();return n(t,c,a,s),c},c=()=>{if(o.size<100)return;const r=Array.from(o.entries()).filter((r=>{let[t,a]=r;return!a.priority}));if(0===r.length)return;r.sort(((r,t)=>r[1].lastAccessed-t[1].lastAccessed));const t=Math.max(1,Math.floor(.2*r.length));for(let a=0;a<t;a++)a<r.length&&o.delete(r[a][0])};setInterval((()=>{const r=Date.now();for(const[t,a]of o.entries())a.expiresAt&&r>a.expiresAt&&o.delete(t)}),6e5)},8670:(r,t,a)=>{a.d(t,{A:()=>i});a(5043);var o=a(5464),e=a(1547),n=a(579);const s=(0,o.Ay)(e.CS.button)`
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px 20px;
  border-radius: var(--border-radius);
  font-weight: 500;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
  border: none;
  outline: none;
  gap: 8px;
  
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  
  ${r=>"primary"===r.variant&&"\n    background-color: var(--primary-color);\n    color: white;\n    \n    &:hover:not(:disabled) {\n      background-color: var(--primary-color-dark);\n    }\n  "}
  
  ${r=>"secondary"===r.variant&&"\n    background-color: var(--secondary-color);\n    color: white;\n    \n    &:hover:not(:disabled) {\n      background-color: var(--secondary-color-dark);\n    }\n  "}
  
  ${r=>"danger"===r.variant&&"\n    background-color: var(--danger-color);\n    color: white;\n    \n    &:hover:not(:disabled) {\n      background-color: var(--danger-color-dark);\n    }\n  "}
  
  ${r=>"outline"===r.variant&&"\n    background-color: transparent;\n    color: var(--primary-color);\n    border: 1px solid var(--primary-color);\n    \n    &:hover:not(:disabled) {\n      background-color: rgba(var(--primary-color-rgb), 0.1);\n    }\n  "}
  
  ${r=>r.fullWidth&&"\n    width: 100%;\n  "}
`,i=r=>{let{variant:t="primary",fullWidth:a=!1,disabled:o=!1,onClick:i,children:c,...l}=r;const[d,u]=(0,e.zh)((()=>({scale:1,config:{tension:300,friction:10}})));return(0,n.jsx)(s,{variant:t,fullWidth:a,disabled:o,onClick:r=>{!o&&i&&u.start({scale:.95,onRest:()=>{u.start({scale:1}),i(r)}})},onMouseEnter:()=>{o||u.start({scale:1.05})},onMouseLeave:()=>{u.start({scale:1})},style:d,...l,children:c})}}}]);
//# sourceMappingURL=448.70958d60.chunk.js.map